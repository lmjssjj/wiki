## DcTracker

```
DcTracker是android上网流程中的“大管家”，起着响应上网拨号，判断当前是否能够拨号，以及管理apn的作用。
```

```
com.android.internal.telephony.dataconnection.DcTracker
```

```
在phone进程启动时，DcTracker会在GsmsCdmaPhone对象的构造函数中通过TelephonyComponentFactory.makeDcTracker方法创建。
DcTracker的构造函数里完成了很多工作，其中比较重要的有:
1. 注册广播监听。
2. 注册Ril监听 (registerForAllEvents)。
3. 注册ServiceStateTracker监听 (registerServiceStateTrackerEvents)。
4. 注册Setting监听 (registerSettingsObserver)。
5. 初始化ApnContext (initApnContexts)。
6. 调用UiccController.registerForIccChanged方法注册了Icc changed的监听。
7. 调用update()–>onUpdateIcc()获取SimRecords信息，并调用SimRecords.registerForRecordsLoaded注册了监听。
8. 还监听了Carriers表中的apn变化(Telephony.Carriers.CONTENT_URI)。
```

```java
//每个Phone对象有自己DcTracker
//每个DcTracker加载各自卡可用的APN
mPhone = phone;
//监听卡载入(当卡状态改变时)
mUiccController = UiccController.getInstance();
mUiccController.registerForIccChanged(this, DctConstants.EVENT_ICC_CHANGED, null);

//监听卡信息变化
mSubscriptionManager = SubscriptionManager.from(mPhone.getContext());
mSubscriptionManager.addOnSubscriptionsChangedListener(mOnSubscriptionsChangedListener);

//监听APN数据库变化
mApnObserver = new ApnChangeObserver();
phone.getContext().getContentResolver().registerContentObserver(
            Telephony.Carriers.CONTENT_URI, true, mApnObserver);
//初始化不同APN类型对应的网络能力
initApnContexts();

// Add Emergency APN to APN setting list by default to support EPDN in sim absent cases
initEmergencyApnSetting();
addEmergencyApnSetting();
```

