https://www.jianshu.com/p/5c732a446495

```
frameworks/base/services/core/java/com/android/server/power/batterysaver
```

```
省电的模块服务：


降低屏幕亮度

在PowerManagerService中更新电源状态的时候调用updateDisplayPowerStateLocked方法时，会获取省电模式状态，保存在DisplayPowerRequest的lowPowerMode属性中。

mDisplayPowerRequest.lowPowerMode =mLowPowerModeEnabled;

最终调用到DisplayPowerController类中，在updatePowerState方法中设置屏幕亮度值，如果处于省电模式状态，设置屏幕亮度值减半处理；PowerMnagerInternal.LowPowerModeListener

此处回过头来看看PowerManagerService的updateLowPowerModeLocked方法中生成的PowerMnagerInternal.LowPowerModeListener数组。该数组是由所有实现PowerMnagerInternal.LowPowerModeListener接口的类组成的。

取消震动效果：VibratorService.java


frameworks/base/services/core/java/com/android/server/VibratorService.java

在systemReady方法中注册省电模式监听器，当省电模式发生改变时回调onLowPowerModeChanged方法，该方法中调用updateInputDeviceVibrators方法。

在updateInputDeviceVibrators方法中获取省电模式状态。

mLowPowerMode = mPowerManagerInternal.getLowPowerModeEnabled();

VibratorService类中startVibrationLocked方法负责震动效果，首先判断是否处于省电模式，若为省电模式直接返回，不再做震动操作。

取消动画设置：WindowManagerService.java

frameworks/base/services/core/java/com/android/server/wm/WindowManagerService.java

         在WindowManagerService的构造方法中，注册省电模式的监听器，当回调onLowPowerModeChanged方法时，比较mAnimationDisabled（窗口动画的使能状态）与省电模式使能状态，如果不相等则为mAnimationDisabled赋值并调用dispatchNewAnimatorScaleLocked方法。

在diapatchNewAnimatorScaleLocked方法中发送H.NEW_ANIMATOR_SCALE消息。

mH接收到H.NEW_ANIMATOR_SCALE消息时，是如何处理的呢？首先调用getCurrentAnimatorScale方法获取当前动画持续时间比，如果处于省电模式状态则返回0，不再开启动画效果。
```

