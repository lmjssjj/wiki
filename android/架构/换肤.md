```
利用给LayoutInflater设置自定义解析器工厂采集需要换肤的控件和需要更改的属性->
保存需要换肤的控件和属性等待换肤时直接给控件设置->
利用反射创建资源包AssetManager 与 Resource->
通过资源包的AssetManager Resource 加载资源包对应的资源->
将新的资源设置给已经采集的控件
```

```
实现 LayoutInflater.Factory2 接口解析收集需要换肤的控件
实现 Application.ActivityLifecycleCallbacks 接口监听activity创建

在oncreate设置解析工厂
oncreate->LayoutInflaterCompat.setFactory2(layoutInflater, skinLayoutInflaterFactory);

创建资源包的Resources用于加载资源
try {

        //反射创建AssetManager 与 Resource
        AssetManager assetManager = AssetManager.class.newInstance();
        //资源路径设置 目录或压缩包
         Method addAssetPath = assetManager.getClass().getMethod("addAssetPath",
                        String.class);
         addAssetPath.invoke(assetManager, skinPath);
         Resources appResource = mContext.getResources();
         //根据当前的显示与配置(横竖屏、语言等)创建Resources
         Resources skinResource = new Resources(assetManager, appResource.getDisplayMetrics
                        (), appResource.getConfiguration());
          //记录
          SkinPreference.getInstance().setSkin(skinPath);
                //获取外部Apk(皮肤包) 包名
          PackageManager mPm = mContext.getPackageManager();
          PackageInfo info = mPm.getPackageArchiveInfo(skinPath, PackageManager
                        .GET_ACTIVITIES);
          String packageName = info.packageName;
          SkinResources.getInstance().applySkin(skinResource, packageName);
        } catch (Exception e) {
                e.printStackTrace();
        }
        
通过采集资源ID获取资源包资源ID
 public int getIdentifier(int resId) {
        if (isDefaultSkin) {
            return resId;
        }
        //在皮肤包中不一定就是 当前程序的 id
        //获取对应id 在当前的名称 colorPrimary
        String resName = mAppResources.getResourceEntryName(resId);
        String resType = mAppResources.getResourceTypeName(resId);
        int skinId = mSkinResources.getIdentifier(resName, resType, mSkinPkgName);
        return skinId;
    }
    
    获取资源
    public Object getBackground(int resId) {
        String resourceTypeName = mAppResources.getResourceTypeName(resId);

        if (resourceTypeName.equals("color")) {
            return getColor(resId);
        } else {
            // drawable
            return getDrawable(resId);
        }
    }
    
    public int getColor(int resId) {
        if (isDefaultSkin) {
            return mAppResources.getColor(resId);
        }
        int skinId = getIdentifier(resId);
        if (skinId == 0) {
            return mAppResources.getColor(resId);
        }
        return mSkinResources.getColor(skinId);
    }
    

```

